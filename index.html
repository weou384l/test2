<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ورود | داشبورد</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- فونت‌ها -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&family=Roboto&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; direction: rtl; }
    body {
      font-family: 'Vazirmatn', 'Roboto', sans-serif;
      background: linear-gradient(to top left, #1e1e2f, #3e3e5e);
      color: #fff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .hidden { display: none; }

    .login-container, .dashboard {
      width: 100%;
      max-width: 420px;
    }

    .login-box {
      background: rgba(255,255,255,0.07);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .login-box h2 { margin-bottom: 20px; }

    .login-box input {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background-color: rgba(255,255,255,0.1);
      color: white;
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background-color: #00b894;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .login-box button:hover { background-color: #019875; }

    .dashboard h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .card {
      background: rgba(255,255,255,0.05);
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 10px;
      backdrop-filter: blur(6px);
      text-align: center;
    }

    .card button {
      padding: 10px 20px;
      background: #0984e3;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .ip-flag {
      vertical-align: middle;
      width: 24px;
      height: 16px;
      border-radius: 2px;
      margin-left: 8px;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(#00cec9 calc(var(--percent) * 1%), rgba(255,255,255,0.1) 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
    }

    .progress-circle span {
      font-size: 22px;
      font-weight: bold;
      color: #00cec9;
    }
  </style>
</head>
<body>
  <!-- فرم ورود -->
  <div id="login-section" class="login-container">
    <div class="login-box">
      <h2>ورود</h2>
      <input type="text" id="username" placeholder="نام کاربری">
      <input type="password" id="password" placeholder="رمز عبور">
      <button onclick="login()">ورود</button>
    </div>
  </div>

  <!-- داشبورد -->
  <div id="dashboard-section" class="dashboard hidden">
    <h1>داشبورد کاربر</h1>

    <div class="card">
      <div class="progress-circle" id="credit-circle" style="--percent: 85;">
        <span id="credit-text">85%</span>
      </div>
      <strong>مانده اعتبار</strong>
    </div>

    <div class="card">
      <strong>وضعیت اتصال:</strong> <span id="https-status">در حال بررسی...</span>
    </div>

    <div class="card">
      <strong>آی‌پی شما:</strong> <span id="ip-info">در حال دریافت...</span>
    </div>

    <div class="card">
      <button onclick="runSpeedTest()">تست سرعت</button>
      <p id="speed-result">در انتظار شروع تست...</p>
    </div>
  </div>

  <!-- اسکریپت -->
  <script>
    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      if (user && pass) {
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("dashboard-section").classList.remove("hidden");
        checkHttps();
        getIP();
      } else {
        alert("لطفاً نام کاربری و رمز را وارد کنید.");
      }
    }

    function checkHttps() {
      const el = document.getElementById("https-status");
      if (location.protocol === "https:") {
        el.textContent = "✅ اتصال امن (HTTPS)";
        el.style.color = "lightgreen";
      } else {
        el.textContent = "⚠️ اتصال ناامن (HTTP)";
        el.style.color = "orange";
      }
    }

    function getIP() {
      fetch("https://ipinfo.io/json?token=8a1e6b0e4d4f69")
        .then(res => res.json())
        .then(data => {
          const flagURL = `https://flagcdn.com/24x18/${data.country.toLowerCase()}.png`;
          document.getElementById("ip-info").innerHTML = `<img class="ip-flag" src="${flagURL}" alt="${data.country}"> ${data.ip} (${data.country})`;
        })
        .catch(() => {
          document.getElementById("ip-info").textContent = "❌ خطا در دریافت آی‌پی";
        });
    }

    function runSpeedTest() {
      const startTime = performance.now();
      fetch("https://corsproxy.io/?https://speed.cloudflare.com/__down?bytes=5000000", { cache: "no-store" })
        .then(() => {
          const endTime = performance.now();
          const duration = (endTime - startTime) / 1000;
          const bitsLoaded = 5000000 * 8;
          const speedMbps = (bitsLoaded / duration / 1024 / 1024).toFixed(2);
          document.getElementById("speed-result").textContent = `📶 سرعت تقریبی: ${speedMbps} مگابیت بر ثانیه`;
        })
        .catch(() => {
          document.getElementById("speed-result").textContent = "❌ تست سرعت با خطا مواجه شد";
        });
    }
  </script>
</body>
</html>
