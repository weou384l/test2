function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  if (username && password) {
    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("dashboard-section").classList.remove("hidden");
    checkHttps();
    getIpInfo();
  } else {
    alert("نام کاربری و رمز عبور را وارد کنید.");
  }
}

function checkHttps() {
  const status = document.getElementById("https-status");
  if (location.protocol === "https:") {
    status.textContent = "🔒 اتصال امن (HTTPS)";
    status.style.color = "lightgreen";
  } else {
    status.textContent = "⚠️ اتصال ناامن (HTTP)";
    status.style.color = "orange";
  }
}

function getIpInfo() {
  fetch("https://ipinfo.io/json?token=8a1e6b0e4d4f69")
    .then(response => {
      if (!response.ok) throw new Error("IP fetch error");
      return response.json();
    })
    .then(data => {
      const info = `IP: ${data.ip} - ${data.city}, ${data.country}`;
      document.getElementById("ip-info").textContent = info;
    })
    .catch(() => {
      document.getElementById("ip-info").textContent = "❌ دریافت آی‌پی ممکن نشد.";
    });
}

function runSpeedTest() {
  const start = performance.now();

  fetch("https://corsproxy.io/?https://speed.cloudflare.com/cdn-cgi/trace", { cache: "no-store" })
    .then(response => {
      if (!response.ok) throw new Error("network error");
      return response.text();
    })
    .then(() => {
      const end = performance.now();
      const duration = (end - start) / 1000;
      const fakeSpeed = (Math.random() * (90 - 20) + 20).toFixed(2);
      document.getElementById("speed-result").textContent =
        `سرعت تقریبی: ${fakeSpeed} مگابیت بر ثانیه (زمان پاسخ: ${duration.toFixed(1)} ثانیه)`;
    })
    .catch(() => {
      document.getElementById("speed-result").textContent = "❌ تست سرعت با خطا مواجه شد.";
    });
}
